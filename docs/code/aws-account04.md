# コマンド説明

## EC2 上で以下のコマンドを実行

```bash
mkdir -p /home/ec2-user/batch/{input,completed,output,db,associate,circuitlist,logs}
chown -R ec2-user:ec2-user /home/ec2-user/batch
chmod -R 755 /home/ec2-user/batch
```

このシェルスクリプトの 3 行は、Linux 上でファイルやディレクトリの**作成・所有者変更・アクセス権変更**をまとめて行うものです。それぞれ詳しく解説します。

---

### 🔸1 行目：

```bash
mkdir -p /home/ec2-user/batch/{input,completed,output,db,associate,circuitlist,logs}
```

#### ✅ 意味：

- `/home/ec2-user/batch` の下に **7 つのサブディレクトリ** を一括で作成します。

  - `input`
  - `completed`
  - `output`
  - `db`
  - `associate`
  - `circuitlist`
  - `logs`

#### ✅ 詳細：

- `mkdir -p` は、**親ディレクトリが存在しない場合にも作成**してくれます。
- `{}` を使うことで一度に複数のディレクトリを作成しています（Bash のブレース展開機能）。

📌 例として展開されるパス：

```
/home/ec2-user/batch/input
/home/ec2-user/batch/completed
/home/ec2-user/batch/output
/home/ec2-user/batch/db
/home/ec2-user/batch/associate
/home/ec2-user/batch/circuitlist
/home/ec2-user/batch/logs
```

---

### 🔸2 行目：

```bash
chown -R ec2-user:ec2-user /home/ec2-user/batch
```

#### ✅ 意味：

- `/home/ec2-user/batch` とその中のすべてのファイル・ディレクトリの**所有者**と**グループ**を `ec2-user` に変更します。

#### ✅ 詳細：

- `chown`：所有者（user）とグループ（group）を変更
- `-R`：**再帰的に**（中のディレクトリ・ファイルすべてに適用）

---

### 🔸3 行目：

```bash
chmod -R 755 /home/ec2-user/batch
```

#### ✅ 意味：

- `/home/ec2-user/batch` 配下の**すべてのファイル・ディレクトリのアクセス権限を `755` に設定**します。

#### ✅ 755 の意味：

- 所有者（u）：**読み・書き・実行可** (7)
- グループ（g）：**読み・実行可** (5)
- その他（o）：**読み・実行可** (5)

#### ✅ 詳細：

- `chmod`: パーミッション（アクセス権）変更
- `-R`: 再帰的に適用

---

### 🔚 まとめ（日本語で要約）：

この 3 行のコードは以下のことを行っています：

1. `/home/ec2-user/batch/` に必要な 7 つのサブフォルダを作成
2. そのフォルダたちの**所有者を `ec2-user` に設定**
3. それらの**アクセス権限を 755 に設定**して、他ユーザーからも読み取り・実行可能に

---

必要なら図解や具体的なパーミッション解説もできます。お気軽にどうぞ！
では、図解と具体的なパーミッションの説明を交えて、以下の順でわかりやすく解説します：

---

## ✅ 全体図（ディレクトリ構成）

```
/home/ec2-user/batch/
├── input/
├── completed/
├── output/
├── db/
├── associate/
├── circuitlist/
└── logs/
```

このように、`batch` の中に 7 つのサブディレクトリができます。

---

## ✅ 所有者とパーミッションの図解（例）

たとえば `input` フォルダについて、以下のようになります：

```
パス                     所有者     グループ     パーミッション（モード）
/home/ec2-user/batch/input    ec2-user  ec2-user     drwxr-xr-x （= 755）
```

ここで注目ポイントは：

| 誰が                 | 何ができるか   | 権限（記号） | 権限（数字） |
| -------------------- | -------------- | ------------ | ------------ |
| 所有者（ec2-user）   | 読み/書き/実行 | `rwx`        | 7            |
| グループ（ec2-user） | 読み/実行      | `r-x`        | 5            |
| その他のユーザー     | 読み/実行      | `r-x`        | 5            |

→ `rwxr-xr-x` = `755` になります。

---

## ✅ `chmod 755` の意味を詳しく

| 権限記号 | 二進数 | 数字表記 | 説明           |
| -------- | ------ | -------- | -------------- |
| `rwx`    | 111    | 7        | 読み+書き+実行 |
| `r-x`    | 101    | 5        | 読み+実行      |
| `r-x`    | 101    | 5        | 読み+実行      |

これを `/home/ec2-user/batch` 配下のすべてに適用することで、

- 所有者（ec2-user）は編集自由
- 他ユーザー（例えばシステム内の別サービスなど）は読み取りと実行だけ可能（書き込み不可）

になります。

---

## ✅ `-R` オプションの働き（再帰的）

`-R` をつけることで、指定したディレクトリ **以下すべて** に処理が適用されます。

### 例：

```bash
chmod -R 755 /home/ec2-user/batch
```

これは、

- `/home/ec2-user/batch`
- `/home/ec2-user/batch/input`
- `/home/ec2-user/batch/output`
- ...など**すべての中身**に `755` を適用する、という意味です。

---

## ✅ なぜこうするのか？（用途）

- **ディレクトリ構造の準備**
  　 → バッチ処理の入力・出力・ログ保存などに必要

- **適切なアクセス権の設定**
  　 → `ec2-user` が自由に使えるが、他人には制限される（セキュリティを守りつつ実行可能）

- **実行ユーザーと所有者の統一**
  　 → 実行するスクリプトやサービスと、ファイルの所有者が一致していれば、パーミッションの問題が起きにくい

---

## ✅ よくある質問：

**Q. ディレクトリに「実行権」が必要なのはなぜ？**
A. ディレクトリの「実行権（x）」は、その中に「入れるか（cd）」や「中身を検索できるか」に関係します。

→ `x` がないと中のファイルにアクセスできません。

---

ご希望であれば、`ls -l` の表示例や、逆に「もっと制限されたパーミッションの設定」も解説できますよ！
